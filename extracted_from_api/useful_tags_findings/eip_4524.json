{
  "tag": "EIP-4524",
  "count": 1,
  "metadata": {
    "totalResults": 1,
    "totalPages": 1
  },
  "last_rateLimit": {
    "limit": 20,
    "remaining": 9,
    "reset": 1771761060
  },
  "findings": [
    {
      "id": "5602",
      "kind": "GIT",
      "auditfirm_id": "2",
      "impact": "MEDIUM",
      "finders_count": 1,
      "protocol_id": "131",
      "title": "[M-09] `HolographERC20` breaks composability by forcing usage of draft proposal EIP-4524",
      "content": "\n[HolographERC20.sol#L539](https://github.com/code-423n4/2022-10-holograph/blob/f8c2eae866280a1acfdc8a8352401ed031be1373/contracts/enforcer/HolographERC20.sol#L539)<br>\n\nHolographERC20 is the ERC20 enforcer for Holograph. In  the safeTransferFrom operation, it calls \\_checkOnERC20Received:\n\n    if (_isEventRegistered(HolographERC20Event.beforeSafeTransfer)) {\n      require(SourceERC20().beforeSafeTransfer(account, recipient, amount, data));\n    }\n    _transfer(account, recipient, amount);\n    require(_checkOnERC20Received(account, recipient, amount, data), \"ERC20: non ERC20Receiver\");\n    if (_isEventRegistered(HolographERC20Event.afterSafeTransfer)) {\n      require(SourceERC20().afterSafeTransfer(account, recipient, amount, data));\n    }\n\nThe checkOnERC20Received function:\n\n    if (_isContract(recipient)) {\n      try ERC165(recipient).supportsInterface(ERC165.supportsInterface.selector) returns (bool erc165support) {\n        require(erc165support, \"ERC20: no ERC165 support\");\n        // we have erc165 support\n        if (ERC165(recipient).supportsInterface(0x534f5876)) {\n          // we have eip-4524 support\n          try ERC20Receiver(recipient).onERC20Received(address(this), account, amount, data) returns (bytes4 retv\n            return retval == ERC20Receiver.onERC20Received.selector;\n          } catch (bytes memory reason) {\n            if (reason.length == 0) {\n              revert(\"ERC20: non ERC20Receiver\");\n            } else {\n              assembly {\n                revert(add(32, reason), mload(reason))\n              }\n            }\n          }\n        } else {\n          revert(\"ERC20: eip-4524 not supported\");\n        }\n      } catch (bytes memory reason) {\n        if (reason.length == 0) {\n          revert(\"ERC20: no ERC165 support\");\n        } else {\n          assembly {\n            revert(add(32, reason), mload(reason))\n          }\n        }\n      }\n    } else {\n      return true;\n    }\n\nIn essence, if the target is a contract, the enforcer requires it to fully implement EIP-4524. The problem is that [this](https://eips.ethereum.org/EIPS/eip-4524) EIP is just a draft proposal, which the project cannot assume to be supported by any receiver contract, and definitely not every receiver contract.\n\nThe specs warn us:\n\n```\n⚠️ This EIP is not recommended for general use or implementation as it is likely to change.\n\n```\n\nTherefore, it is a very dangerous requirement to add in an ERC20 enforcer, and must be left to the implementation to do if it so desires.\n\n### Impact\n\nERC20s enforced by HolographERC20 are completely uncomposable. They cannot be used for almost any DeFi application, making it basically useless.\n\n### Recommended Mitigation Steps\n\nRemove the EIP-4524 requirements altogether.\n\n**[gzeon (judge) commented](https://github.com/code-423n4/2022-10-holograph-findings/issues/440#issuecomment-1297240122):**\n > Low risk unless this is not a design decision.\n\n**[alexanderattar (Holograph) confirmed and commented](https://github.com/code-423n4/2022-10-holograph-findings/issues/440#issuecomment-1306639824):**\n > Originally a design choice, but it can be updated to not revert if the EIP is not supported.\n\n**[Trust (warden) commented](https://github.com/code-423n4/2022-10-holograph-findings/issues/440#issuecomment-1306719396):**\n > Will argue that philosophically any code is originally a design choice. If it's later made clear the choice has unintended dire consequences then the finding should not be penalized because of that alone. \n\n**[ACC01ADE (Holograph) linked a PR](https://github.com/code-423n4/2022-10-holograph-findings/issues/440#ref-pullrequest-1452472274):**\n > [Feature/HOLO-605: C4 medium risk fixes](https://github.com/holographxyz/holograph-protocol/pull/88)\n\n\n\n***\n\n",
      "summary": "\nThis bug report is about the HolographERC20 ERC20 enforcer for Holograph, which is used for enforcing ERC20 tokens. The enforcer requires any target contract to fully implement EIP-4524, which is a draft proposal and not recommended for general use or implementation. This requirement makes the ERC20s enforced by HolographERC20 completely uncomposable, which means they cannot be used for almost any DeFi application, making them basically useless. The recommended mitigation step for this vulnerability is to remove the EIP-4524 requirements altogether. The bug was discovered through manual audit.",
      "report_date": {},
      "contest_prize_txt": "$75,000 USDC",
      "contest_link": "https://code4rena.com/contests/2022-10-holograph-contest",
      "sponsor_name": "Holograph",
      "sponsor_link": "https://twitter.com/holographxyz",
      "quality_score": 4,
      "general_score": 4,
      "source_link": "https://code4rena.com/reports/2022-10-holograph",
      "github_link": "https://github.com/code-423n4/2022-10-holograph-findings/issues/440",
      "pdf_link": "",
      "pdf_page_from": 0,
      "contest_id": "170",
      "slug": "m-09-holographerc20-breaks-composability-by-forcing-usage-of-draft-proposal-eip-4524-code4rena-holograph-holograph-contest-git",
      "firm_name": "Code4rena",
      "firm_logo_square": "code4rena_square.png",
      "protocol_name": "Holograph",
      "bookmarked": false,
      "read": false,
      "auditfirms_auditfirm": {
        "name": "Code4rena",
        "logo_square": "code4rena_square.png"
      },
      "protocols_protocol": {
        "name": "Holograph",
        "protocols_protocolcategoryscore": [
          {
            "protocols_protocolcategory": {
              "title": "Dexes"
            },
            "score": 0.5
          },
          {
            "protocols_protocolcategory": {
              "title": "Bridge"
            },
            "score": 0.5
          },
          {
            "protocols_protocolcategory": {
              "title": "Services"
            },
            "score": 0.5
          },
          {
            "protocols_protocolcategory": {
              "title": "Launchpad"
            },
            "score": 0.5
          },
          {
            "protocols_protocolcategory": {
              "title": "NFT Marketplace"
            },
            "score": 0.5
          }
        ]
      },
      "issues_issuetagscore": [
        {
          "tags_tag": {
            "title": "EIP-4524"
          }
        }
      ]
    }
  ]
}